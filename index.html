<!DOCTYPE html>
<html lang="ja">
<head><link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#444">
<link rel="apple-touch-icon" href="icon-192.png">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚³ãƒ¡ãƒ€äºˆç®—ã‚¬ãƒãƒ£</title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",sans-serif;
  background:#fafafa;margin:0;padding:20px;
}
h1{text-align:center;font-size:22px;}
select,input,button{
  width:100%;padding:12px;margin:6px 0;
  font-size:16px;border-radius:8px;
}
button{border:none;background:#444;color:#fff;}
.sub{background:#777;}
.share{background:#1d9bf0;}

.card{
  background:#fff;border-radius:10px;
  padding:15px;margin-top:15px;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
}
.line{margin:5px 0;}
.total{font-size:18px;font-weight:bold;margin-top:10px;}
.ok{color:#0a7f2e;}
.over{color:#c40000;}
.badge{font-size:12px;padding:4px 8px;border-radius:6px;margin-left:6px;}
.ssr{background:#ffd700;}
.fail{background:#ffb3b3;}

.stats{
  margin-top:15px;font-size:14px;
  background:#fff;border-radius:10px;
  padding:10px;box-shadow:0 2px 6px rgba(0,0,0,.08);
}
.stats div{margin:4px 0;}
</style>
</head>

<body>

<h1>â˜• ã‚³ãƒ¡ãƒ€äºˆç®—ã‚¬ãƒãƒ£</h1>

<select id="people">
  <option value="1">ğŸ‘¤ 1äºº</option>
  <option value="2">ğŸ‘¥ 2äºº</option>
</select>

<input type="number" id="budget" value="1000" min="300" step="100">

<button onclick="draw('morning')">ğŸŒ… æœã‚¬ãƒãƒ£</button>
<button onclick="draw('lunch')">ğŸŒ æ˜¼ã‚¬ãƒãƒ£</button>
<button onclick="draw('night')">ğŸŒ™ å¤œã‚¬ãƒãƒ£</button>
<button class="sub" onclick="redraw()">ğŸ” å¼•ãç›´ã—</button>
<button class="share" onclick="share()">ğŸ“£ Xã§å…±æœ‰</button>

<div class="card">
  <div id="output">ã¾ã å›ã—ã¦ã„ã¾ã›ã‚“</div>
</div>

<div class="stats" id="stats"></div>

<script>
let lastTime=null,lastText="";
let count=0,ssr=0,success=0,fail=0;

const data={
  morning:{
    drinks:[["ãƒ–ãƒ¬ãƒ³ãƒ‰",460],["ã‚¢ã‚¤ã‚¹",460],["ã‚ªãƒ¼ãƒ¬",500],["ã‚¢ã‚¤ã‚¹ã‚ªãƒ¼ãƒ¬",520],["ãƒŸãƒ«ã‚¯",540],["ã‚¢ãƒ¡ãƒªã‚«ãƒ³",460]],
    food:[["ãƒ¢ãƒ¼ãƒ‹ãƒ³ã‚°(ç„¡æ–™)",0],["å°å€‰ãƒˆãƒ¼ã‚¹ãƒˆ",0],["ãƒ­ãƒ¼ãƒ–ãƒ‘ãƒ³",0],["å±±é£Ÿ",0]],
    extra:[["ãªã—",0],["ã‚†ã§åµ",50],["ã‚µãƒ©ãƒ€",120],["è¿½åŠ ãƒˆãƒ¼ã‚¹ãƒˆ",260],["ã‚¯ãƒ­ãƒ¯ãƒƒã‚µãƒ³",260],["ã‚½ãƒ•ãƒˆ",300]]
  },
  lunch:{
    drinks:[["ãƒ–ãƒ¬ãƒ³ãƒ‰",460],["ã‚¢ã‚¤ã‚¹",460],["ã‚ªãƒ¼ãƒ¬",500],["ã‚¢ã‚¤ã‚¹ã‚ªãƒ¼ãƒ¬",520],["ã‚¯ãƒªã‚½",600],["ã‚³ãƒ¼ãƒ©",520]],
    food:[["ãƒˆãƒ¼ã‚¹ãƒˆ",260],["å°å€‰ãƒˆãƒ¼ã‚¹ãƒˆ",360],["ãƒŸãƒ‹ã‚·ãƒ­",470],["ãƒãƒ†ãƒã‚­",520],["ã‚¯ãƒ­ãƒ¯ãƒƒã‚µãƒ³",260],["ã‚µãƒ³ãƒ‰åŠåˆ†",500]],
    extra:[["ãªã—",0],["ãƒŸãƒ‹ãƒ‡ã‚¶",250],["ã‚½ãƒ•ãƒˆ",300],["è¿½åŠ ãƒˆãƒ¼ã‚¹ãƒˆ",260],["å¼•ãç›´ã—",0]]
  },
  night:{
    drinks:[["ãƒ–ãƒ¬ãƒ³ãƒ‰",460],["ã‚¢ã‚¤ã‚¹",460],["ã‚ªãƒ¼ãƒ¬",500],["ã‚³ãƒ¼ãƒ©",520],["ãƒ¡ãƒ­ãƒ³",520],["ã‚¯ãƒªã‚½",600]],
    food:[["ãƒˆãƒ¼ã‚¹ãƒˆ",260],["ãƒŸãƒ‹ã‚·ãƒ­",470],["ãƒãƒ†ãƒã‚­",520],["ãƒã‚­ãƒ³ãƒã‚¹",700],["ã‚¯ãƒ­ãƒ¯ãƒƒã‚µãƒ³",260],["ã‚µãƒ³ãƒ‰åŠåˆ†",500]],
    extra:[["ãªã—",0],["ãƒãƒ†ãƒˆ",300],["ã‚½ãƒ•ãƒˆ",300],["ãƒ‡ã‚¶ãƒ¼ãƒˆ",250],["å¼•ãç›´ã—",0]]
  }
};

const r=a=>a[Math.floor(Math.random()*a.length)];

function updateURL(){
  const p=document.getElementById("people").value;
  const b=document.getElementById("budget").value;
  history.replaceState(null,"",`?people=${p}&budget=${b}`);
}

function draw(time){
  updateURL();
  lastTime=time;
  count++;

  const people=Number(document.getElementById("people").value);
  const budget=Number(document.getElementById("budget").value);

  let items=[],total=0;

  for(let i=0;i<people;i++){
    let d=r(data[time].drinks);
    items.push(`â˜• ${d[0]}ï¼ˆ${d[1]}ï¼‰`);
    total+=d[1];
  }

  let food=r(data[time].food);
  let extra=r(data[time].extra);
  total+=food[1]+extra[1];

  let judge,cls;
 let judge, cls;
if (total >= budget - 50 && total <= budget + 50) {
  judge = "SSR";
  cls = "ok";
  ssr++;
} else if (total <= budget) {
  judge = "æˆåŠŸ";
  cls = "ok";
  success++;
} else {
  judge = "çˆ†æ­»";
  cls = "over";
  fail++;
}
  else if(total<=budget){judge="æˆåŠŸ";cls="ok";success++;}
  else{judge="çˆ†æ­»";cls="over";fail++;}

  lastText=`ã€${time}ãƒ»${people}äººãƒ»${budget}å††ã€‘
${items.join(" / ")}
${food[0]} + ${extra[0]}
åˆè¨ˆ ${total}å††ï¼ˆ${judge}ï¼‰
#ã‚³ãƒ¡ãƒ€äºˆç®—ã‚¬ãƒãƒ£`;

  document.getElementById("output").innerHTML=`
    ${items.map(v=>`<div class="line">${v}</div>`).join("")}
    <div class="line">ğŸ ${food[0]}ï¼ˆ${food[1]}ï¼‰</div>
    <div class="line">â• ${extra[0]}ï¼ˆ${extra[1]}ï¼‰</div>
    <div class="total ${cls}">
      åˆè¨ˆ ${total}å††
      <span class="badge ${judge==="SSR"?"ssr":"fail"}">${judge}</span>
    </div>
  `;

  document.getElementById("stats").innerHTML=`
    <div>ğŸ° å›æ•°ï¼š${count}</div>
    <div>âœ¨ SSRï¼š${ssr}</div>
    <div>âœ… æˆåŠŸï¼š${success}</div>
    <div>ğŸ’€ çˆ†æ­»ï¼š${fail}</div>
    <div>ğŸ“Š æˆåŠŸç‡ï¼š${((ssr+success)/count*100).toFixed(1)}%</div>
  `;
}

function redraw(){ if(lastTime) draw(lastTime); }

function share(){
  if(!lastText)return;
  window.open(
    "https://twitter.com/intent/tweet?text="+encodeURIComponent(lastText+location.search),
    "_blank"
  );
}

/* URLèª­ã¿è¾¼ã¿æ™‚ã®åæ˜  */
const q=new URLSearchParams(location.search);
if(q.get("people"))document.getElementById("people").value=q.get("people");
if(q.get("budget"))document.getElementById("budget").value=q.get("budget");
</script>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>

</body>
</html>
